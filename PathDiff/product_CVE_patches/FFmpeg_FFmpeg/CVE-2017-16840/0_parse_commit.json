{
    "current_hash": "94e538aebbc9f9c529e8b1f2eda860cfb8c473b1",
    "parent_hash": "479e65ba47a140307ea5d0d8de36244541aa4cbe",
    "modified_file_0": {
        "mod_filename": "libavcodec/vc2enc.c",
        "status": "modified",
        "add_lines": 3,
        "dele_lines": 2,
        "patch": "@@ -1106,8 +1106,9 @@ static av_cold int vc2_encode_init(AVCodecContext *avctx)\n \n         /* DWT init */\n         if (ff_vc2enc_init_transforms(&s->transform_args[i].t,\n-                                        s->plane[0].coef_stride,\n-                                        s->plane[0].dwt_height))\n+                                      s->plane[i].coef_stride,\n+                                      s->plane[i].dwt_height,\n+                                      s->slice_width, s->slice_height))\n             goto alloc_fail;\n     }\n "
    },
    "modified_file_1": {
        "mod_filename": "libavcodec/vc2enc_dwt.c",
        "status": "modified",
        "add_lines": 9,
        "dele_lines": 3,
        "patch": "@@ -211,19 +211,25 @@ static void vc2_subband_dwt_53(VC2TransformContext *t, dwtcoef *data,\n     deinterleave(data, stride, width, height, synth);\n }\n \n-av_cold int ff_vc2enc_init_transforms(VC2TransformContext *s, int p_width, int p_height)\n+av_cold int ff_vc2enc_init_transforms(VC2TransformContext *s, int p_stride,\n+                                      int p_height, int slice_w, int slice_h)\n {\n     s->vc2_subband_dwt[VC2_TRANSFORM_9_7]    = vc2_subband_dwt_97;\n     s->vc2_subband_dwt[VC2_TRANSFORM_5_3]    = vc2_subband_dwt_53;\n \n-    s->buffer = av_malloc(2*p_width*p_height*sizeof(dwtcoef));\n+    /* Pad by the slice size, only matters for non-Haar wavelets */\n+    s->buffer = av_calloc((p_stride + slice_w)*(p_height + slice_h), sizeof(dwtcoef));\n     if (!s->buffer)\n         return 1;\n \n+    s->padding = (slice_h >> 1)*p_stride + (slice_w >> 1);\n+    s->buffer += s->padding;\n+\n     return 0;\n }\n \n av_cold void ff_vc2enc_free_transforms(VC2TransformContext *s)\n {\n-    av_freep(&s->buffer);\n+    av_free(s->buffer - s->padding);\n+    s->buffer = NULL;\n }"
    },
    "modified_file_2": {
        "mod_filename": "libavcodec/vc2enc_dwt.h",
        "status": "modified",
        "add_lines": 3,
        "dele_lines": 1,
        "patch": "@@ -44,12 +44,14 @@ enum VC2TransformType {\n \n typedef struct VC2TransformContext {\n     dwtcoef *buffer;\n+    int padding;\n     void (*vc2_subband_dwt[VC2_TRANSFORMS_NB])(struct VC2TransformContext *t,\n                                                dwtcoef *data, ptrdiff_t stride,\n                                                int width, int height);\n } VC2TransformContext;\n \n-int  ff_vc2enc_init_transforms(VC2TransformContext *t, int p_width, int p_height);\n+int  ff_vc2enc_init_transforms(VC2TransformContext *t, int p_stride, int p_height,\n+                               int slice_w, int slice_h);\n void ff_vc2enc_free_transforms(VC2TransformContext *t);\n \n #endif /* AVCODEC_VC2ENC_DWT_H */"
    }
}