{
    "current_hash": "e477f09d0b3619f3d29173b2cd593e17e2d1978e",
    "parent_hash": "084f3addda7531a22d656b769120c6453e880226",
    "modified_file_0": {
        "mod_filename": "libavcodec/pngdec.c",
        "status": "modified",
        "add_lines": 14,
        "dele_lines": 1,
        "patch": "@@ -772,6 +772,16 @@ static int decode_trns_chunk(AVCodecContext *avctx, PNGDecContext *s,\n {\n     int v, i;\n \n+    if (!(s->state & PNG_IHDR)) {\n+        av_log(avctx, AV_LOG_ERROR, \"trns before IHDR\\n\");\n+        return AVERROR_INVALIDDATA;\n+    }\n+\n+    if (s->state & PNG_IDAT) {\n+        av_log(avctx, AV_LOG_ERROR, \"trns after IDAT\\n\");\n+        return AVERROR_INVALIDDATA;\n+    }\n+\n     if (s->color_type == PNG_COLOR_TYPE_PALETTE) {\n         if (length > 256 || !(s->state & PNG_PLTE))\n             return AVERROR_INVALIDDATA;\n@@ -782,7 +792,8 @@ static int decode_trns_chunk(AVCodecContext *avctx, PNGDecContext *s,\n         }\n     } else if (s->color_type == PNG_COLOR_TYPE_GRAY || s->color_type == PNG_COLOR_TYPE_RGB) {\n         if ((s->color_type == PNG_COLOR_TYPE_GRAY && length != 2) ||\n-            (s->color_type == PNG_COLOR_TYPE_RGB && length != 6))\n+            (s->color_type == PNG_COLOR_TYPE_RGB && length != 6) ||\n+            s->bit_depth == 1)\n             return AVERROR_INVALIDDATA;\n \n         for (i = 0; i < length / 2; i++) {\n@@ -1242,6 +1253,8 @@ static int decode_frame_common(AVCodecContext *avctx, PNGDecContext *s,\n         size_t raw_bpp = s->bpp - byte_depth;\n         unsigned x, y;\n \n+        av_assert0(s->bit_depth > 1);\n+\n         for (y = 0; y < s->height; ++y) {\n             uint8_t *row = &s->image_buf[s->image_linesize * y];\n "
    }
}