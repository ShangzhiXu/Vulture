{
    "current_hash": "27a99e2c7d450fef15594671eef4465c8a166bd7",
    "parent_hash": "437b7302b09a04e0fbfcd594114b52c5c6d89d32",
    "modified_file_0": {
        "mod_filename": "libavformat/vividas.c",
        "status": "modified",
        "add_lines": 6,
        "dele_lines": 6,
        "patch": "@@ -28,6 +28,7 @@\n  * @sa http://wiki.multimedia.cx/index.php?title=Vividas_VIV\n  */\n \n+#include \"libavutil/avassert.h\"\n #include \"libavutil/intreadwrite.h\"\n #include \"avio_internal.h\"\n #include \"avformat.h\"\n@@ -379,7 +380,7 @@ static int track_header(VividasDemuxContext *viv, AVFormatContext *s,  uint8_t *\n \n         if (avio_tell(pb) < off) {\n             int num_data;\n-            int xd_size = 0;\n+            int xd_size = 1;\n             int data_len[256];\n             int offset = 1;\n             uint8_t *p;\n@@ -393,10 +394,10 @@ static int track_header(VividasDemuxContext *viv, AVFormatContext *s,  uint8_t *\n                     return AVERROR_INVALIDDATA;\n                 }\n                 data_len[j] = len;\n-                xd_size += len;\n+                xd_size += len + 1 + len/255;\n             }\n \n-            ret = ff_alloc_extradata(st->codecpar, 64 + xd_size + xd_size / 255);\n+            ret = ff_alloc_extradata(st->codecpar, xd_size);\n             if (ret < 0)\n                 return ret;\n \n@@ -405,9 +406,7 @@ static int track_header(VividasDemuxContext *viv, AVFormatContext *s,  uint8_t *\n \n             for (j = 0; j < num_data - 1; j++) {\n                 unsigned delta = av_xiphlacing(&p[offset], data_len[j]);\n-                if (delta > data_len[j]) {\n-                    return AVERROR_INVALIDDATA;\n-                }\n+                av_assert0(delta <= xd_size - offset);\n                 offset += delta;\n             }\n \n@@ -418,6 +417,7 @@ static int track_header(VividasDemuxContext *viv, AVFormatContext *s,  uint8_t *\n                     av_freep(&st->codecpar->extradata);\n                     break;\n                 }\n+                av_assert0(data_len[j] <= xd_size - offset);\n                 offset += data_len[j];\n             }\n "
    }
}