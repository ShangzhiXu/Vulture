{
    "current_hash": "3bce9e9b3ea35c54bacccc793d7da99ea5157532",
    "parent_hash": "47d5d0cc74d047ce49c0d89878dadb09e8fb8b9c",
    "modified_file_0": {
        "mod_filename": "libavformat/tty.c",
        "status": "modified",
        "add_lines": 20,
        "dele_lines": 1,
        "patch": "@@ -34,6 +34,13 @@\n #include \"internal.h\"\n #include \"sauce.h\"\n \n+static int isansicode(int x)\n+{\n+    return x == 0x1B || x == 0x0A || x == 0x0D || (x >= 0x20 && x < 0x7f);\n+}\n+\n+static const char tty_extensions[31] = \"ans,art,asc,diz,ice,nfo,txt,vt\";\n+\n typedef struct TtyDemuxContext {\n     AVClass *class;\n     int chars_per_frame;\n@@ -42,6 +49,17 @@ typedef struct TtyDemuxContext {\n     AVRational framerate; /**< Set by a private option. */\n } TtyDemuxContext;\n \n+static int read_probe(const AVProbeData *p)\n+{\n+    int cnt = 0;\n+\n+    for (int i = 0; i < p->buf_size; i++)\n+        cnt += !!isansicode(p->buf[i]);\n+\n+    return (cnt * 100LL / p->buf_size) * (cnt > 400) *\n+        !!av_match_ext(p->filename, tty_extensions);\n+}\n+\n /**\n  * Parse EFI header\n  */\n@@ -153,8 +171,9 @@ AVInputFormat ff_tty_demuxer = {\n     .name           = \"tty\",\n     .long_name      = NULL_IF_CONFIG_SMALL(\"Tele-typewriter\"),\n     .priv_data_size = sizeof(TtyDemuxContext),\n+    .read_probe     = read_probe,\n     .read_header    = read_header,\n     .read_packet    = read_packet,\n-    .extensions     = \"ans,art,asc,diz,ice,nfo,txt,vt\",\n+    .extensions     = tty_extensions,\n     .priv_class     = &tty_demuxer_class,\n };"
    }
}