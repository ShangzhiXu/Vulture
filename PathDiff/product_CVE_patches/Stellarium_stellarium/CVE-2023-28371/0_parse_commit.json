{
    "current_hash": "1261f74dc4aa6bbd01ab514343424097f8cf46b7",
    "parent_hash": "2a2f8a111375e6037a847109d72eddf07a330be2",
    "modified_file_0": {
        "mod_filename": "src/scripting/StelScriptOutput.cpp",
        "status": "modified",
        "add_lines": 6,
        "dele_lines": 6,
        "patch": "@@ -56,15 +56,15 @@ void StelScriptOutput::reset(void)\n void StelScriptOutput::saveOutputAs(const QString &name)\n {\n \tQFile asFile;\n-\tQFileInfo outputInfo(outputFile);\n-\tQDir dir=outputInfo.dir(); // will hold complete dirname\n-\tQFileInfo newFileNameInfo(name);\n+\tconst QFileInfo outputInfo(outputFile);\n+\tconst QDir dir=outputInfo.dir(); // will hold complete dirname\n+\tconst QFileInfo newFileNameInfo(name);\n \n-\tbool okToSaveToAbsolutePath=StelApp::getInstance().getSettings()->value(\"scripts/flag_script_allow_write_absolute_path\", false).toBool();\n+\tconst bool okToSaveToAbsolutePath=StelApp::getInstance().getSettings()->value(\"scripts/flag_script_allow_write_absolute_path\", false).toBool();\n \n-\tif (!okToSaveToAbsolutePath && (newFileNameInfo.isAbsolute()))\n+\tif (!okToSaveToAbsolutePath && ((newFileNameInfo.isAbsolute() || (name.contains(\"..\"))))) // The last condition may include dangerous/malicious paths\n \t{\n-\t\tqWarning() << \"SCRIPTING CONFIGURATION ISSUE: You are trying to save to an absolute pathname.\";\n+\t\tqWarning() << \"SCRIPTING CONFIGURATION ISSUE: You are trying to save to an absolute pathname or move up in directories.\";\n \t\tqWarning() << \"  To enable this, edit config.ini and set [scripts]/flag_script_allow_write_absolute_path=true\";\n \t\tasFile.setFileName(dir.absolutePath() + \"/\" + newFileNameInfo.fileName());\n \t\tqWarning() << \"  Storing to \" << asFile.fileName() << \" instead\";"
    },
    "modified_file_1": {
        "mod_filename": "src/scripting/StelScriptOutput.hpp",
        "status": "modified",
        "add_lines": 2,
        "dele_lines": 1,
        "patch": "@@ -41,12 +41,13 @@ class StelScriptOutput\n \tstatic void writeLog(QString msg);\n \n \t//! Reset file, i.e., empty it. This may be useful to have repetitive output which may be read by other programs.\n+\t//! Normally you would call saveOutputAs(...), then reset().\n \tstatic void reset(void);\n \n \t//! Save to new file, re-create output file.\n \t//! This allows reading of results on Windows, where otherwise reading programs cannot access files opened for writing by Stellarium.\n \t//! @param name new filename. If this is not an absolute path, it will be created in the same directory as output.txt\n-\t//! @note For storing to absolute path names, set [scripts]/flag_script_allow_write_absolute_path=true.\n+\t//! @note For storing to absolute path names or paths containing directory navigation (\"..\"), set [scripts]/flag_script_allow_write_absolute_path=true.\n \t//! Normally you would call saveOutputAs(...), then reset().\n \tstatic void saveOutputAs(const QString& name);\n "
    }
}