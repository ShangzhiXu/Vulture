{
    "current_hash": "591c546c536b42bef696d027f64aa22434f8c3f0",
    "parent_hash": "e79417ed7185b150a056d4eb3a1ab528b91d2fc0",
    "modified_file_0": {
        "mod_filename": "src/shared/gatt-server.c",
        "status": "modified",
        "add_lines": 22,
        "dele_lines": 0,
        "patch": "@@ -779,6 +779,20 @@ static uint8_t authorize_req(struct bt_gatt_server *server,\n \t\t\t\t\t\tserver->authorize_data);\n }\n \n+static uint8_t check_length(uint16_t length, uint16_t offset)\n+{\n+\tif (length > BT_ATT_MAX_VALUE_LEN)\n+\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n+\n+\tif (offset > BT_ATT_MAX_VALUE_LEN)\n+\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n+\n+\tif (length + offset > BT_ATT_MAX_VALUE_LEN)\n+\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n+\n+\treturn 0;\n+}\n+\n static void write_cb(struct bt_att_chan *chan, uint8_t opcode, const void *pdu,\n \t\t\t\t\tuint16_t length, void *user_data)\n {\n@@ -809,6 +823,10 @@ static void write_cb(struct bt_att_chan *chan, uint8_t opcode, const void *pdu,\n \t\t\t\t(opcode == BT_ATT_OP_WRITE_REQ) ? \"Req\" : \"Cmd\",\n \t\t\t\thandle);\n \n+\tecode = check_length(length, 0);\n+\tif (ecode)\n+\t\tgoto error;\n+\n \tecode = check_permissions(server, attr, BT_ATT_PERM_WRITE_MASK);\n \tif (ecode)\n \t\tgoto error;\n@@ -1299,6 +1317,10 @@ static void prep_write_cb(struct bt_att_chan *chan, uint8_t opcode,\n \tutil_debug(server->debug_callback, server->debug_data,\n \t\t\t\t\"Prep Write Req - handle: 0x%04x\", handle);\n \n+\tecode = check_length(length, offset);\n+\tif (ecode)\n+\t\tgoto error;\n+\n \tecode = check_permissions(server, attr, BT_ATT_PERM_WRITE_MASK);\n \tif (ecode)\n \t\tgoto error;"
    }
}