{
    "current_hash": "768f60da87a3fa0b5561da5ade9309577c176d04",
    "parent_hash": "e281fa673e8b29b553f97f87918cc723ee4ceaa8",
    "modified_file_0": {
        "mod_filename": "crawl-ref/source/clua.cc",
        "status": "modified",
        "add_lines": 17,
        "dele_lines": 0,
        "patch": "@@ -776,10 +776,27 @@ void CLua::init_lua()\n     setregistry(\"__clua\");\n }\n \n+static int lua_loadstring(lua_State *ls)\n+{\n+    const auto lua = luaL_checkstring(ls, 1);\n+    if (lua[0] == 0x1b)\n+        abort();\n+    lua_settop(ls, 0);\n+    if (luaL_loadstring(ls, lua))\n+    {\n+        lua_pushnil(ls);\n+        lua_insert(ls, 1);\n+    }\n+    return lua_gettop(ls);\n+}\n+\n void CLua::init_libraries()\n {\n     lua_stack_cleaner clean(state());\n \n+    lua_pushcfunction(_state, lua_loadstring);\n+    lua_setglobal(_state, \"loadstring\");\n+\n     // Open Crawl bindings\n     cluaopen_kills(_state);\n     cluaopen_you(_state);"
    }
}