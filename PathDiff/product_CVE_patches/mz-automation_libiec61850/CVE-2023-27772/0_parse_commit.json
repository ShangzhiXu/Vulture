{
    "current_hash": "79a8eaf26070e02044afc4b2ffbfe777dfdf3e0b",
    "parent_hash": "76fd58e9be880cb9306b5f497dd4614e7353156e",
    "modified_file_0": {
        "mod_filename": "examples/iec61850_client_example_control/client_example_control.c",
        "status": "modified",
        "add_lines": 106,
        "dele_lines": 77,
        "patch": "@@ -45,8 +45,10 @@ int main(int argc, char** argv) {\n \n     IedConnection_connect(con, &error, hostname, tcpPort);\n \n-    if (error == IED_ERROR_OK) {\n-\n+    if (error == IED_ERROR_OK)\n+    {\n+        MmsValue* ctlVal = NULL;\n+        MmsValue* stVal = NULL;\n \n         /************************\n          * Direct control\n@@ -55,99 +57,116 @@ int main(int argc, char** argv) {\n         ControlObjectClient control\n             = ControlObjectClient_create(\"simpleIOGenericIO/GGIO1.SPCSO1\", con);\n \n-        MmsValue* ctlVal = MmsValue_newBoolean(true);\n+        if (control)\n+        {\n+            ctlVal = MmsValue_newBoolean(true);\n \n-        ControlObjectClient_setOrigin(control, NULL, 3);\n+            ControlObjectClient_setOrigin(control, NULL, 3);\n \n-        if (ControlObjectClient_operate(control, ctlVal, 0 /* operate now */)) {\n-            printf(\"simpleIOGenericIO/GGIO1.SPCSO1 operated successfully\\n\");\n-        }\n-        else {\n-            printf(\"failed to operate simpleIOGenericIO/GGIO1.SPCSO1\\n\");\n-        }\n+            if (ControlObjectClient_operate(control, ctlVal, 0 /* operate now */)) {\n+                printf(\"simpleIOGenericIO/GGIO1.SPCSO1 operated successfully\\n\");\n+            }\n+            else {\n+                printf(\"failed to operate simpleIOGenericIO/GGIO1.SPCSO1\\n\");\n+            }\n+\n+            MmsValue_delete(ctlVal);\n \n-        MmsValue_delete(ctlVal);\n+            ControlObjectClient_destroy(control);\n \n-        ControlObjectClient_destroy(control);\n+            /* Check if status value has changed */\n \n-        /* Check if status value has changed */\n+            stVal = IedConnection_readObject(con, &error, \"simpleIOGenericIO/GGIO1.SPCSO1.stVal\", IEC61850_FC_ST);\n \n-        MmsValue* stVal = IedConnection_readObject(con, &error, \"simpleIOGenericIO/GGIO1.SPCSO1.stVal\", IEC61850_FC_ST);\n+            if (error == IED_ERROR_OK) {\n+                bool state = MmsValue_getBoolean(stVal);\n+                MmsValue_delete(stVal);\n \n-        if (error == IED_ERROR_OK) {\n-            bool state = MmsValue_getBoolean(stVal);\n-            MmsValue_delete(stVal);\n+                printf(\"New status of simpleIOGenericIO/GGIO1.SPCSO1.stVal: %i\\n\", state);\n+            }\n+            else {\n+                printf(\"Reading status for simpleIOGenericIO/GGIO1.SPCSO1 failed!\\n\");\n+            }\n \n-            printf(\"New status of simpleIOGenericIO/GGIO1.SPCSO1.stVal: %i\\n\", state);\n         }\n         else {\n-            printf(\"Reading status for simpleIOGenericIO/GGIO1.SPCSO1 failed!\\n\");\n+            printf(\"Control object simpleIOGenericIO/GGIO1.SPCSO1 not found in server\\n\");\n         }\n \n-\n         /************************\n          * Select before operate\n          ***********************/\n \n         control = ControlObjectClient_create(\"simpleIOGenericIO/GGIO1.SPCSO2\", con);\n \n-        if (ControlObjectClient_select(control)) {\n+        if (control)\n+        {\n+            if (ControlObjectClient_select(control)) {\n \n-            ctlVal = MmsValue_newBoolean(true);\n+                ctlVal = MmsValue_newBoolean(true);\n \n-            if (ControlObjectClient_operate(control, ctlVal, 0 /* operate now */)) {\n-                printf(\"simpleIOGenericIO/GGIO1.SPCSO2 operated successfully\\n\");\n+                if (ControlObjectClient_operate(control, ctlVal, 0 /* operate now */)) {\n+                    printf(\"simpleIOGenericIO/GGIO1.SPCSO2 operated successfully\\n\");\n+                }\n+                else {\n+                    printf(\"failed to operate simpleIOGenericIO/GGIO1.SPCSO2!\\n\");\n+                }\n+\n+                MmsValue_delete(ctlVal);\n             }\n             else {\n-                printf(\"failed to operate simpleIOGenericIO/GGIO1.SPCSO2!\\n\");\n+                printf(\"failed to select simpleIOGenericIO/GGIO1.SPCSO2!\\n\");\n             }\n \n-            MmsValue_delete(ctlVal);\n+            ControlObjectClient_destroy(control);\n         }\n         else {\n-            printf(\"failed to select simpleIOGenericIO/GGIO1.SPCSO2!\\n\");\n+            printf(\"Control object simpleIOGenericIO/GGIO1.SPCSO2 not found in server\\n\");\n         }\n \n-        ControlObjectClient_destroy(control);\n-\n-\n         /****************************************\n          * Direct control with enhanced security\n          ****************************************/\n \n         control = ControlObjectClient_create(\"simpleIOGenericIO/GGIO1.SPCSO3\", con);\n \n-        ControlObjectClient_setCommandTerminationHandler(control, commandTerminationHandler, NULL);\n+        if (control)\n+        {\n+            ControlObjectClient_setCommandTerminationHandler(control, commandTerminationHandler, NULL);\n \n-        ctlVal = MmsValue_newBoolean(true);\n+            ctlVal = MmsValue_newBoolean(true);\n \n-        if (ControlObjectClient_operate(control, ctlVal, 0 /* operate now */)) {\n-            printf(\"simpleIOGenericIO/GGIO1.SPCSO3 operated successfully\\n\");\n-        }\n-        else {\n-            printf(\"failed to operate simpleIOGenericIO/GGIO1.SPCSO3\\n\");\n-        }\n+            if (ControlObjectClient_operate(control, ctlVal, 0 /* operate now */)) {\n+                printf(\"simpleIOGenericIO/GGIO1.SPCSO3 operated successfully\\n\");\n+            }\n+            else {\n+                printf(\"failed to operate simpleIOGenericIO/GGIO1.SPCSO3\\n\");\n+            }\n \n-        MmsValue_delete(ctlVal);\n+            MmsValue_delete(ctlVal);\n \n-        /* Wait for command termination message */\n-        Thread_sleep(1000);\n+            /* Wait for command termination message */\n+            Thread_sleep(1000);\n \n-        ControlObjectClient_destroy(control);\n+            ControlObjectClient_destroy(control);\n \n-        /* Check if status value has changed */\n+            /* Check if status value has changed */\n \n-       stVal = IedConnection_readObject(con, &error, \"simpleIOGenericIO/GGIO1.SPCSO3.stVal\", IEC61850_FC_ST);\n+            stVal = IedConnection_readObject(con, &error, \"simpleIOGenericIO/GGIO1.SPCSO3.stVal\", IEC61850_FC_ST);\n \n-        if (error == IED_ERROR_OK) {\n-            bool state = MmsValue_getBoolean(stVal);\n+            if (error == IED_ERROR_OK) {\n+                bool state = MmsValue_getBoolean(stVal);\n \n-            printf(\"New status of simpleIOGenericIO/GGIO1.SPCSO3.stVal: %i\\n\", state);\n+                printf(\"New status of simpleIOGenericIO/GGIO1.SPCSO3.stVal: %i\\n\", state);\n \n-            MmsValue_delete(stVal);\n+                MmsValue_delete(stVal);\n+            }\n+            else {\n+                printf(\"Reading status for simpleIOGenericIO/GGIO1.SPCSO3 failed!\\n\");\n+            }\n         }\n         else {\n-            printf(\"Reading status for simpleIOGenericIO/GGIO1.SPCSO3 failed!\\n\");\n+            printf(\"Control object simpleIOGenericIO/GGIO1.SPCSO3 not found in server\\n\");\n         }\n \n         /***********************************************\n@@ -156,56 +175,66 @@ int main(int argc, char** argv) {\n \n         control = ControlObjectClient_create(\"simpleIOGenericIO/GGIO1.SPCSO4\", con);\n \n-        ControlObjectClient_setCommandTerminationHandler(control, commandTerminationHandler, NULL);\n+        if (control)\n+        {\n+            ControlObjectClient_setCommandTerminationHandler(control, commandTerminationHandler, NULL);\n \n-        ctlVal = MmsValue_newBoolean(true);\n+            ctlVal = MmsValue_newBoolean(true);\n \n-        if (ControlObjectClient_selectWithValue(control, ctlVal)) {\n+            if (ControlObjectClient_selectWithValue(control, ctlVal)) {\n+\n+                if (ControlObjectClient_operate(control, ctlVal, 0 /* operate now */)) {\n+                    printf(\"simpleIOGenericIO/GGIO1.SPCSO4 operated successfully\\n\");\n+                }\n+                else {\n+                    printf(\"failed to operate simpleIOGenericIO/GGIO1.SPCSO4!\\n\");\n+                }\n \n-            if (ControlObjectClient_operate(control, ctlVal, 0 /* operate now */)) {\n-                printf(\"simpleIOGenericIO/GGIO1.SPCSO4 operated successfully\\n\");\n             }\n             else {\n-                printf(\"failed to operate simpleIOGenericIO/GGIO1.SPCSO4!\\n\");\n+                printf(\"failed to select simpleIOGenericIO/GGIO1.SPCSO4!\\n\");\n             }\n \n+            MmsValue_delete(ctlVal);\n+\n+            /* Wait for command termination message */\n+            Thread_sleep(1000);\n+\n+            ControlObjectClient_destroy(control);\n         }\n         else {\n-            printf(\"failed to select simpleIOGenericIO/GGIO1.SPCSO4!\\n\");\n+            printf(\"Control object simpleIOGenericIO/GGIO1.SPCSO4 not found in server\\n\");\n         }\n \n-        MmsValue_delete(ctlVal);\n-\n-        /* Wait for command termination message */\n-        Thread_sleep(1000);\n-\n-        ControlObjectClient_destroy(control);\n-\n-\n         /*********************************************************************\n          * Direct control with enhanced security (expect CommandTermination-)\n          *********************************************************************/\n \n         control = ControlObjectClient_create(\"simpleIOGenericIO/GGIO1.SPCSO9\", con);\n \n-        ControlObjectClient_setCommandTerminationHandler(control, commandTerminationHandler, NULL);\n-\n-        ctlVal = MmsValue_newBoolean(true);\n+        if (control)\n+        {\n+            ControlObjectClient_setCommandTerminationHandler(control, commandTerminationHandler, NULL);\n \n-        if (ControlObjectClient_operate(control, ctlVal, 0 /* operate now */)) {\n-            printf(\"simpleIOGenericIO/GGIO1.SPCSO9 operated successfully\\n\");\n-        }\n-        else {\n-            printf(\"failed to operate simpleIOGenericIO/GGIO1.SPCSO9\\n\");\n-        }\n+            ctlVal = MmsValue_newBoolean(true);\n \n-        MmsValue_delete(ctlVal);\n+            if (ControlObjectClient_operate(control, ctlVal, 0 /* operate now */)) {\n+                printf(\"simpleIOGenericIO/GGIO1.SPCSO9 operated successfully\\n\");\n+            }\n+            else {\n+                printf(\"failed to operate simpleIOGenericIO/GGIO1.SPCSO9\\n\");\n+            }\n \n-        /* Wait for command termination message */\n-        Thread_sleep(1000);\n+            MmsValue_delete(ctlVal);\n \n-        ControlObjectClient_destroy(control);\n+            /* Wait for command termination message */\n+            Thread_sleep(1000);\n \n+            ControlObjectClient_destroy(control);\n+        }\n+        else {\n+            printf(\"Control object simpleIOGenericIO/GGIO1.SPCSO9 not found in server\\n\");\n+        }\n \n         IedConnection_close(con);\n     }"
    }
}