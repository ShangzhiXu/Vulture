{
    "current_hash": "553f2fa65865c31c5e3c48812cfd46176cffdd27",
    "parent_hash": "8e4d861fbb9ca3a5f37ff28d079c6d74a8f92d38",
    "modified_file_0": {
        "mod_filename": "ChangeLog",
        "status": "modified",
        "add_lines": 1,
        "dele_lines": 0,
        "patch": "@@ -1,3 +1,4 @@\n+* [Bug 1593] ntpd abort in free() with logconfig syntax error.\n * [Bug 1581] from 4.2.6p3-beta1: ntp_intres.c size_t printf format\n   string mismatch.\n * [Bug 1586] ntpd 4.2.7p40 doesn't write to syslog after fork on QNX."
    },
    "modified_file_1": {
        "mod_filename": "ntpd/ntp_parser.c",
        "status": "modified",
        "add_lines": 62,
        "dele_lines": 52,
        "patch": "@@ -937,12 +937,12 @@ static const yytype_uint16 yyrline[] =\n      875,   876,   877,   878,   879,   880,   889,   890,   906,   912,\n      914,   916,   918,   920,   923,   925,   936,   938,   940,   950,\n      952,   954,   956,   958,   963,   965,   969,   973,   975,   980,\n-     982,   986,   987,   991,   992,   996,  1011,  1016,  1024,  1025,\n-    1029,  1030,  1031,  1032,  1036,  1037,  1038,  1048,  1049,  1053,\n-    1055,  1060,  1062,  1066,  1071,  1072,  1076,  1077,  1081,  1090,\n-    1091,  1095,  1096,  1105,  1120,  1124,  1125,  1129,  1130,  1134,\n-    1135,  1139,  1144,  1148,  1152,  1153,  1157,  1162,  1163,  1167,\n-    1169,  1171,  1173,  1175\n+     982,   986,   987,   991,   992,   996,  1021,  1026,  1034,  1035,\n+    1039,  1040,  1041,  1042,  1046,  1047,  1048,  1058,  1059,  1063,\n+    1065,  1070,  1072,  1076,  1081,  1082,  1086,  1087,  1091,  1100,\n+    1101,  1105,  1106,  1115,  1130,  1134,  1135,  1139,  1140,  1144,\n+    1145,  1149,  1154,  1158,  1162,  1163,  1167,  1172,  1173,  1177,\n+    1179,  1181,  1183,  1185\n };\n #endif\n \n@@ -3530,22 +3530,32 @@ yyparse ()\n /* Line 1455 of yacc.c  */\n #line 997 \"ntp_parser.y\"\n     {\n-\t\t\tchar prefix = (yyvsp[(1) - (1)].String)[0];\n-\t\t\tchar *type = (yyvsp[(1) - (1)].String) + 1;\n+\t\t\tchar\tprefix;\n+\t\t\tchar *\ttype;\n \t\t\t\n-\t\t\tif (prefix != '+' && prefix != '-' && prefix != '=') {\n-\t\t\t\tyyerror(\"Logconfig prefix is not '+', '-' or '='\\n\");\n-\t\t\t}\n-\t\t\telse\n-\t\t\t\t(yyval.Attr_val) = create_attr_sval(prefix, estrdup(type));\n+\t\t\tswitch ((yyvsp[(1) - (1)].String)[0]) {\n+\t\t\t\n+\t\t\tcase '+':\n+\t\t\tcase '-':\n+\t\t\tcase '=':\n+\t\t\t\tprefix = (yyvsp[(1) - (1)].String)[0];\n+\t\t\t\ttype = (yyvsp[(1) - (1)].String) + 1;\n+\t\t\t\tbreak;\n+\t\t\t\t\n+\t\t\tdefault:\n+\t\t\t\tprefix = '=';\n+\t\t\t\ttype = (yyvsp[(1) - (1)].String);\n+\t\t\t}\t\n+\t\t\t\n+\t\t\t(yyval.Attr_val) = create_attr_sval(prefix, estrdup(type));\n \t\t\tYYFREE((yyvsp[(1) - (1)].String));\n \t\t}\n     break;\n \n   case 216:\n \n /* Line 1455 of yacc.c  */\n-#line 1012 \"ntp_parser.y\"\n+#line 1022 \"ntp_parser.y\"\n     {\n \t\t\tenqueue(cfgt.nic_rules,\n \t\t\t\tcreate_nic_rule_node((yyvsp[(3) - (3)].Integer), NULL, (yyvsp[(2) - (3)].Integer)));\n@@ -3555,7 +3565,7 @@ yyparse ()\n   case 217:\n \n /* Line 1455 of yacc.c  */\n-#line 1017 \"ntp_parser.y\"\n+#line 1027 \"ntp_parser.y\"\n     {\n \t\t\tenqueue(cfgt.nic_rules,\n \t\t\t\tcreate_nic_rule_node(0, (yyvsp[(3) - (3)].String), (yyvsp[(2) - (3)].Integer)));\n@@ -3565,77 +3575,77 @@ yyparse ()\n   case 227:\n \n /* Line 1455 of yacc.c  */\n-#line 1048 \"ntp_parser.y\"\n+#line 1058 \"ntp_parser.y\"\n     { (yyval.Queue) = enqueue((yyvsp[(1) - (2)].Queue), create_ival((yyvsp[(2) - (2)].Integer))); }\n     break;\n \n   case 228:\n \n /* Line 1455 of yacc.c  */\n-#line 1049 \"ntp_parser.y\"\n+#line 1059 \"ntp_parser.y\"\n     { (yyval.Queue) = enqueue_in_new_queue(create_ival((yyvsp[(1) - (1)].Integer))); }\n     break;\n \n   case 229:\n \n /* Line 1455 of yacc.c  */\n-#line 1054 \"ntp_parser.y\"\n+#line 1064 \"ntp_parser.y\"\n     { (yyval.Queue) = enqueue((yyvsp[(1) - (2)].Queue), (yyvsp[(2) - (2)].Attr_val)); }\n     break;\n \n   case 230:\n \n /* Line 1455 of yacc.c  */\n-#line 1056 \"ntp_parser.y\"\n+#line 1066 \"ntp_parser.y\"\n     { (yyval.Queue) = enqueue_in_new_queue((yyvsp[(1) - (1)].Attr_val)); }\n     break;\n \n   case 231:\n \n /* Line 1455 of yacc.c  */\n-#line 1061 \"ntp_parser.y\"\n+#line 1071 \"ntp_parser.y\"\n     { (yyval.Attr_val) = create_attr_ival('i', (yyvsp[(1) - (1)].Integer)); }\n     break;\n \n   case 233:\n \n /* Line 1455 of yacc.c  */\n-#line 1067 \"ntp_parser.y\"\n+#line 1077 \"ntp_parser.y\"\n     { (yyval.Attr_val) = create_attr_shorts('-', (yyvsp[(2) - (5)].Integer), (yyvsp[(4) - (5)].Integer)); }\n     break;\n \n   case 234:\n \n /* Line 1455 of yacc.c  */\n-#line 1071 \"ntp_parser.y\"\n+#line 1081 \"ntp_parser.y\"\n     { (yyval.Queue) = enqueue((yyvsp[(1) - (2)].Queue), create_pval((yyvsp[(2) - (2)].String))); }\n     break;\n \n   case 235:\n \n /* Line 1455 of yacc.c  */\n-#line 1072 \"ntp_parser.y\"\n+#line 1082 \"ntp_parser.y\"\n     { (yyval.Queue) = enqueue_in_new_queue(create_pval((yyvsp[(1) - (1)].String))); }\n     break;\n \n   case 236:\n \n /* Line 1455 of yacc.c  */\n-#line 1076 \"ntp_parser.y\"\n+#line 1086 \"ntp_parser.y\"\n     { (yyval.Queue) = enqueue((yyvsp[(1) - (2)].Queue), (yyvsp[(2) - (2)].Address_node)); }\n     break;\n \n   case 237:\n \n /* Line 1455 of yacc.c  */\n-#line 1077 \"ntp_parser.y\"\n+#line 1087 \"ntp_parser.y\"\n     { (yyval.Queue) = enqueue_in_new_queue((yyvsp[(1) - (1)].Address_node)); }\n     break;\n \n   case 238:\n \n /* Line 1455 of yacc.c  */\n-#line 1082 \"ntp_parser.y\"\n+#line 1092 \"ntp_parser.y\"\n     {\n \t\t\tif ((yyvsp[(1) - (1)].Integer) != 0 && (yyvsp[(1) - (1)].Integer) != 1) {\n \t\t\t\tyyerror(\"Integer value is not boolean (0 or 1). Assuming 1\");\n@@ -3649,28 +3659,28 @@ yyparse ()\n   case 239:\n \n /* Line 1455 of yacc.c  */\n-#line 1090 \"ntp_parser.y\"\n+#line 1100 \"ntp_parser.y\"\n     { (yyval.Integer) = 1; }\n     break;\n \n   case 240:\n \n /* Line 1455 of yacc.c  */\n-#line 1091 \"ntp_parser.y\"\n+#line 1101 \"ntp_parser.y\"\n     { (yyval.Integer) = 0; }\n     break;\n \n   case 241:\n \n /* Line 1455 of yacc.c  */\n-#line 1095 \"ntp_parser.y\"\n+#line 1105 \"ntp_parser.y\"\n     { (yyval.Double) = (double)(yyvsp[(1) - (1)].Integer); }\n     break;\n \n   case 243:\n \n /* Line 1455 of yacc.c  */\n-#line 1106 \"ntp_parser.y\"\n+#line 1116 \"ntp_parser.y\"\n     {\n \t\t\tcfgt.sim_details = create_sim_node((yyvsp[(3) - (5)].Queue), (yyvsp[(4) - (5)].Queue));\n \n@@ -3682,147 +3692,147 @@ yyparse ()\n   case 244:\n \n /* Line 1455 of yacc.c  */\n-#line 1120 \"ntp_parser.y\"\n+#line 1130 \"ntp_parser.y\"\n     { old_config_style = 0; }\n     break;\n \n   case 245:\n \n /* Line 1455 of yacc.c  */\n-#line 1124 \"ntp_parser.y\"\n+#line 1134 \"ntp_parser.y\"\n     { (yyval.Queue) = enqueue((yyvsp[(1) - (3)].Queue), (yyvsp[(2) - (3)].Attr_val)); }\n     break;\n \n   case 246:\n \n /* Line 1455 of yacc.c  */\n-#line 1125 \"ntp_parser.y\"\n+#line 1135 \"ntp_parser.y\"\n     { (yyval.Queue) = enqueue_in_new_queue((yyvsp[(1) - (2)].Attr_val)); }\n     break;\n \n   case 247:\n \n /* Line 1455 of yacc.c  */\n-#line 1129 \"ntp_parser.y\"\n+#line 1139 \"ntp_parser.y\"\n     { (yyval.Attr_val) = create_attr_dval((yyvsp[(1) - (3)].Integer), (yyvsp[(3) - (3)].Double)); }\n     break;\n \n   case 248:\n \n /* Line 1455 of yacc.c  */\n-#line 1130 \"ntp_parser.y\"\n+#line 1140 \"ntp_parser.y\"\n     { (yyval.Attr_val) = create_attr_dval((yyvsp[(1) - (3)].Integer), (yyvsp[(3) - (3)].Double)); }\n     break;\n \n   case 249:\n \n /* Line 1455 of yacc.c  */\n-#line 1134 \"ntp_parser.y\"\n+#line 1144 \"ntp_parser.y\"\n     { (yyval.Queue) = enqueue((yyvsp[(1) - (2)].Queue), (yyvsp[(2) - (2)].Sim_server)); }\n     break;\n \n   case 250:\n \n /* Line 1455 of yacc.c  */\n-#line 1135 \"ntp_parser.y\"\n+#line 1145 \"ntp_parser.y\"\n     { (yyval.Queue) = enqueue_in_new_queue((yyvsp[(1) - (1)].Sim_server)); }\n     break;\n \n   case 251:\n \n /* Line 1455 of yacc.c  */\n-#line 1140 \"ntp_parser.y\"\n+#line 1150 \"ntp_parser.y\"\n     { (yyval.Sim_server) = create_sim_server((yyvsp[(1) - (5)].Address_node), (yyvsp[(3) - (5)].Double), (yyvsp[(4) - (5)].Queue)); }\n     break;\n \n   case 252:\n \n /* Line 1455 of yacc.c  */\n-#line 1144 \"ntp_parser.y\"\n+#line 1154 \"ntp_parser.y\"\n     { (yyval.Double) = (yyvsp[(3) - (4)].Double); }\n     break;\n \n   case 253:\n \n /* Line 1455 of yacc.c  */\n-#line 1148 \"ntp_parser.y\"\n+#line 1158 \"ntp_parser.y\"\n     { (yyval.Address_node) = (yyvsp[(3) - (3)].Address_node); }\n     break;\n \n   case 254:\n \n /* Line 1455 of yacc.c  */\n-#line 1152 \"ntp_parser.y\"\n+#line 1162 \"ntp_parser.y\"\n     { (yyval.Queue) = enqueue((yyvsp[(1) - (2)].Queue), (yyvsp[(2) - (2)].Sim_script)); }\n     break;\n \n   case 255:\n \n /* Line 1455 of yacc.c  */\n-#line 1153 \"ntp_parser.y\"\n+#line 1163 \"ntp_parser.y\"\n     { (yyval.Queue) = enqueue_in_new_queue((yyvsp[(1) - (1)].Sim_script)); }\n     break;\n \n   case 256:\n \n /* Line 1455 of yacc.c  */\n-#line 1158 \"ntp_parser.y\"\n+#line 1168 \"ntp_parser.y\"\n     { (yyval.Sim_script) = create_sim_script_info((yyvsp[(3) - (6)].Double), (yyvsp[(5) - (6)].Queue)); }\n     break;\n \n   case 257:\n \n /* Line 1455 of yacc.c  */\n-#line 1162 \"ntp_parser.y\"\n+#line 1172 \"ntp_parser.y\"\n     { (yyval.Queue) = enqueue((yyvsp[(1) - (3)].Queue), (yyvsp[(2) - (3)].Attr_val)); }\n     break;\n \n   case 258:\n \n /* Line 1455 of yacc.c  */\n-#line 1163 \"ntp_parser.y\"\n+#line 1173 \"ntp_parser.y\"\n     { (yyval.Queue) = enqueue_in_new_queue((yyvsp[(1) - (2)].Attr_val)); }\n     break;\n \n   case 259:\n \n /* Line 1455 of yacc.c  */\n-#line 1168 \"ntp_parser.y\"\n+#line 1178 \"ntp_parser.y\"\n     { (yyval.Attr_val) = create_attr_dval((yyvsp[(1) - (3)].Integer), (yyvsp[(3) - (3)].Double)); }\n     break;\n \n   case 260:\n \n /* Line 1455 of yacc.c  */\n-#line 1170 \"ntp_parser.y\"\n+#line 1180 \"ntp_parser.y\"\n     { (yyval.Attr_val) = create_attr_dval((yyvsp[(1) - (3)].Integer), (yyvsp[(3) - (3)].Double)); }\n     break;\n \n   case 261:\n \n /* Line 1455 of yacc.c  */\n-#line 1172 \"ntp_parser.y\"\n+#line 1182 \"ntp_parser.y\"\n     { (yyval.Attr_val) = create_attr_dval((yyvsp[(1) - (3)].Integer), (yyvsp[(3) - (3)].Double)); }\n     break;\n \n   case 262:\n \n /* Line 1455 of yacc.c  */\n-#line 1174 \"ntp_parser.y\"\n+#line 1184 \"ntp_parser.y\"\n     { (yyval.Attr_val) = create_attr_dval((yyvsp[(1) - (3)].Integer), (yyvsp[(3) - (3)].Double)); }\n     break;\n \n   case 263:\n \n /* Line 1455 of yacc.c  */\n-#line 1176 \"ntp_parser.y\"\n+#line 1186 \"ntp_parser.y\"\n     { (yyval.Attr_val) = create_attr_dval((yyvsp[(1) - (3)].Integer), (yyvsp[(3) - (3)].Double)); }\n     break;\n \n \n \n /* Line 1455 of yacc.c  */\n-#line 3826 \"ntp_parser.c\"\n+#line 3836 \"ntp_parser.c\"\n       default: break;\n     }\n   YY_SYMBOL_PRINT (\"-> $$ =\", yyr1[yyn], &yyval, &yyloc);\n@@ -4034,7 +4044,7 @@ yyparse ()\n \n \n /* Line 1675 of yacc.c  */\n-#line 1180 \"ntp_parser.y\"\n+#line 1190 \"ntp_parser.y\"\n \n \n void yyerror (char *msg)"
    },
    "modified_file_2": {
        "mod_filename": "ntpd/ntp_parser.y",
        "status": "modified",
        "add_lines": 17,
        "dele_lines": 7,
        "patch": "@@ -995,14 +995,24 @@ log_config_list\n log_config_command\n \t:\tT_String\n \t\t{\n-\t\t\tchar prefix = $1[0];\n-\t\t\tchar *type = $1 + 1;\n+\t\t\tchar\tprefix;\n+\t\t\tchar *\ttype;\n \t\t\t\n-\t\t\tif (prefix != '+' && prefix != '-' && prefix != '=') {\n-\t\t\t\tyyerror(\"Logconfig prefix is not '+', '-' or '='\\n\");\n-\t\t\t}\n-\t\t\telse\n-\t\t\t\t$$ = create_attr_sval(prefix, estrdup(type));\n+\t\t\tswitch ($1[0]) {\n+\t\t\t\n+\t\t\tcase '+':\n+\t\t\tcase '-':\n+\t\t\tcase '=':\n+\t\t\t\tprefix = $1[0];\n+\t\t\t\ttype = $1 + 1;\n+\t\t\t\tbreak;\n+\t\t\t\t\n+\t\t\tdefault:\n+\t\t\t\tprefix = '=';\n+\t\t\t\ttype = $1;\n+\t\t\t}\t\n+\t\t\t\n+\t\t\t$$ = create_attr_sval(prefix, estrdup(type));\n \t\t\tYYFREE($1);\n \t\t}\n \t;"
    }
}