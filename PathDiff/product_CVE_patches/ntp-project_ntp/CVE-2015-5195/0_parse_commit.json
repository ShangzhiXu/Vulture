{
    "current_hash": "52e977d79a0c4ace997e5c74af429844da2f27be",
    "parent_hash": "7b80ae621b32f2edb1adc1f5130b68ae1e5cc2b0",
    "modified_file_0": {
        "mod_filename": "ChangeLog",
        "status": "modified",
        "add_lines": 2,
        "dele_lines": 0,
        "patch": "@@ -1,3 +1,5 @@\n+* [Bug 1773] openssl not detected during ./configure.\n+* [Bug 1774] Segfaults if cryptostats enabled and built without OpenSSL.\n (4.2.7p111) 2011/01/05 Released by Harlan Stenn <stenn@ntp.org>\n * [Bug 1772] refclock_open() return value check wrong for ACTS.\n * Default --with-openssl-libdir and --with-openssl-incdir to the values"
    },
    "modified_file_1": {
        "mod_filename": "m4/ntp_openssl.m4",
        "status": "modified",
        "add_lines": 16,
        "dele_lines": 22,
        "patch": "@@ -31,23 +31,20 @@ case \"$ans\" in\n      '')\n \t;;\n      *)\n-\tpkgans=`$PKG_CONFIG --libs-only-L openssl | sed -e 's/^-L//'`\n-\tcase \"$pkgans\" in\n-\t '')\n-\t    # Look in:\n-\t    ans=\"/usr/lib /usr/lib/openssl /usr/sfw/lib\"\n-\t    ans=\"$ans /usr/local/lib /usr/local/ssl/lib /lib\"\n-\t    ;;\n-\t *)\n-\t    ans=\"$pkgans\"\n-\t    ;;\n-\tesac\n+\tpkgans=\"`$PKG_CONFIG --libs-only-L openssl | sed -e 's/^-L//'`\" 2>/dev/null\n+\ttest -f \"${pkgans}/pkgconfig/openssl.pc\" && ans=\"$pkgans\"\n \t;;\n     esac\n     ;;\n  *) # Look where they said\n     ;;\n esac\n+case \"$ans\" in\n+ yes)\n+    # Look in:\n+    ans=\"/usr/lib /usr/lib/openssl /usr/sfw/lib\"\n+    ans=\"$ans /usr/local/lib /usr/local/ssl/lib /lib\"\n+esac\n case \"$ans\" in\n  no)\n     ;;\n@@ -100,23 +97,20 @@ case \"$ans\" in\n      '')\n \t;;\n      *)\n-\tpkgans=`$PKG_CONFIG --cflags-only-I openssl | sed -e 's/^-I//'`\n-\tcase \"$pkgans\" in\n-\t '')\n-\t    # Look in:\n-\t    ans=\"/usr/include /usr/sfw/include /usr/local/include\"\n-\t    ans=\"$ans /usr/local/ssl/include\"\n-\t    ;;\n-\t *)\n-\t    ans=\"$pkgans\"\n-\t    ;;\n-\tesac\n+\tpkgans=\"`$PKG_CONFIG --cflags-only-I openssl | sed -e 's/^-I//'`\" 2>/dev/null\n+\ttest -f \"${pkgans}/pkgconfig/openssl.pc\" && ans=\"$pkgans\"\n \t;;\n     esac\n     ;;\n  *) # Look where they said\n     ;;\n esac\n+case \"$ans\" in\n+ yes)\n+    # Look in:\n+    ans=\"/usr/include /usr/sfw/include /usr/local/include\"\n+    ans=\"$ans /usr/local/ssl/include\"\n+esac\n case \"$ans\" in\n  no)\n     ;;"
    },
    "modified_file_2": {
        "mod_filename": "ntpd/ntp_config.c",
        "status": "modified",
        "add_lines": 12,
        "dele_lines": 0,
        "patch": "@@ -2015,6 +2015,12 @@ config_monitor(\n \tfor (; pfilegen_token != NULL; pfilegen_token = pfilegen_token->link) {\n \t\tfilegen_string = keyword(pfilegen_token->i);\n \t\tfilegen = filegen_get(filegen_string);\n+\t\tif (NULL == filegen) {\n+\t\t\tmsyslog(LOG_ERR,\n+\t\t\t\t\"stats %s unrecognized\",\n+\t\t\t\tfilegen_string);\n+\t\t\tcontinue;\n+\t\t}\n \t\tDPRINTF(4, (\"enabling filegen for %s statistics '%s%s'\\n\",\n \t\t\t    filegen_string, filegen->prefix, \n \t\t\t    filegen->basename));\n@@ -2026,6 +2032,12 @@ config_monitor(\n \tfor (; my_node != NULL; my_node = my_node->link) {\n \t\tfilegen_file = keyword(my_node->filegen_token);\n \t\tfilegen = filegen_get(filegen_file);\n+\t\tif (NULL == filegen) {\n+\t\t\tmsyslog(LOG_ERR,\n+\t\t\t\t\"filegen category '%s' unrecognized\",\n+\t\t\t\tfilegen_file);\n+\t\t\tcontinue;\n+\t\t}\n \n \t\t/* Initialize the filegen variables to their pre-configuration states */\n \t\tfilegen_flag = filegen->flag;"
    },
    "modified_file_3": {
        "mod_filename": "ntpd/ntp_util.c",
        "status": "modified",
        "add_lines": 2,
        "dele_lines": 10,
        "patch": "@@ -80,12 +80,6 @@ double\twander_threshold = 1e-7;\t/* initial frequency threshold */\n # define MAXPATHLEN 256\n #endif\n \n-#ifdef DEBUG_TIMING\n-static FILEGEN timingstats;\n-#endif\n-#ifdef AUTOKEY\n-static FILEGEN cryptostats;\n-#endif\t/* AUTOKEY */\n \n static\tchar statsdir[MAXPATHLEN] = NTP_VAR;\n static FILEGEN peerstats;\n@@ -94,6 +88,8 @@ static FILEGEN clockstats;\n static FILEGEN rawstats;\n static FILEGEN sysstats;\n static FILEGEN protostats;\n+static FILEGEN cryptostats;\n+static FILEGEN timingstats;\n \n /*\n  * This controls whether stats are written to the fileset. Provided\n@@ -173,12 +169,8 @@ init_util(void)\n \tfilegen_register(statsdir, \"rawstats\",\t  &rawstats);\n \tfilegen_register(statsdir, \"sysstats\",\t  &sysstats);\n \tfilegen_register(statsdir, \"protostats\",  &protostats);\n-#ifdef AUTOKEY\n \tfilegen_register(statsdir, \"cryptostats\", &cryptostats);\n-#endif\t/* AUTOKEY */\n-#ifdef DEBUG_TIMING\n \tfilegen_register(statsdir, \"timingstats\", &timingstats);\n-#endif\t/* DEBUG_TIMING */\n \t/*\n \t * register with libntp ntp_set_tod() to call us back\n \t * when time is stepped."
    }
}