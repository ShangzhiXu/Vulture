{
    "current_hash": "246d8ae0cef27377e5dfe9ee3ad87e864d6b6266",
    "parent_hash": "dc8e66109eb46a80383185f72eddc02e40704ca0",
    "modified_file_0": {
        "mod_filename": "src/misc.c",
        "status": "modified",
        "add_lines": 13,
        "dele_lines": 5,
        "patch": "@@ -251,6 +251,8 @@ net_bind(short unsigned *port, int type, const char *log_service_name)\n   struct addrinfo hints = { 0 };\n   struct addrinfo *servinfo;\n   struct addrinfo *ptr;\n+  union net_sockaddr naddr = { 0 };\n+  socklen_t naddr_len = sizeof(naddr);\n   const char *cfgaddr;\n   char addr[INET6_ADDRSTRLEN];\n   char strport[8];\n@@ -314,16 +316,22 @@ net_bind(short unsigned *port, int type, const char *log_service_name)\n       goto error;\n     }\n \n-  // Get the port that was assigned\n-  ret = getsockname(fd, ptr->ai_addr, &ptr->ai_addrlen);\n+  // Get our address (as string) and the port that was assigned (necessary when\n+  // caller didn't specify a port)\n+  ret = getsockname(fd, &naddr.sa, &naddr_len);\n   if (ret < 0)\n     {\n-      DPRINTF(E_LOG, L_MISC, \"Could not find address of service '%s': %s\\n\", log_service_name, strerror(errno));\n+      DPRINTF(E_LOG, L_MISC, \"Error finding address of service '%s': %s\\n\", log_service_name, strerror(errno));\n+      goto error;\n+    }\n+  else if (naddr_len > sizeof(naddr))\n+    {\n+      DPRINTF(E_LOG, L_MISC, \"Unexpected address length of service '%s'\\n\", log_service_name);\n       goto error;\n     }\n \n-  net_port_get(port, (union net_sockaddr *)ptr->ai_addr);\n-  net_address_get(addr, sizeof(addr), (union net_sockaddr *)ptr->ai_addr);\n+  net_port_get(port, &naddr);\n+  net_address_get(addr, sizeof(addr), &naddr);\n \n   DPRINTF(E_DBG, L_MISC, \"Service '%s' bound to %s, port %hu, socket %d\\n\", log_service_name, addr, *port, fd);\n "
    }
}