{
    "current_hash": "6cf0236184ff6304bf5e267ccf7ef02874069697",
    "parent_hash": "6886689b6bee217a74fc1cc4e01e341fee015a06",
    "modified_file_0": {
        "mod_filename": "doas.c",
        "status": "modified",
        "add_lines": 17,
        "dele_lines": 8,
        "patch": "@@ -542,6 +542,23 @@ main(int argc, char **argv)\n \t    LOGIN_SETPRIORITY | LOGIN_SETRESOURCES | LOGIN_SETUMASK |\n \t    LOGIN_SETUSER) != 0)\n \t\terrx(1, \"failed to set user context for target\");\n+#else\n+\t#if defined(__linux__) || defined(__FreeBSD__) || defined(__NetBSD__)\n+\tif (setresgid(target_pw->pw_gid, target_pw->pw_gid, target_pw->pw_gid) == -1)\n+\t\terr(1, \"setresgid\");\n+\t#else\n+\tif (setregid(target_pw->pw_gid, target_pw->pw_gid) == -1)\n+\t\terr(1, \"setregid\");\n+\t#endif\n+\tif (initgroups(target_pw->pw_name, target_pw->pw_gid) == -1)\n+\t\terr(1, \"initgroups\");\n+\t#if defined(__linux__) || defined(__FreeBSD__) || defined(__NetBSD__)\n+\tif (setresuid(target, target, target) == -1)\n+\t\terr(1, \"setresuid\");\n+\t#else\n+\tif (setreuid(target, target) == -1)\n+\t\terr(1, \"setreuid\");\n+\t#endif\n #endif\n         /*\n \tif (pledge(\"stdio rpath exec\", NULL) == -1)\n@@ -557,14 +574,6 @@ main(int argc, char **argv)\n         if (pledge(\"stdio exec\", NULL) == -1)\n \t\terr(1, \"pledge\");\n         */\n-#ifndef HAVE_LOGIN_CAP_H\n-        /* If we effectively are root, set the UID to actually be root to avoid\n-           permission errors. */\n-        if (target != 0)\n-           setuid(target);\n-        if ( geteuid() == ROOT_UID )\n-           setuid(ROOT_UID);\n-#endif\n \n \tsyslog(LOG_AUTHPRIV | LOG_INFO, \"%s ran command %s as %s from %s\",\n \t    myname, cmdline, target_pw->pw_name, cwd);"
    }
}